digraph state_graph {
	rankdir=TB;
	size="8,5;"
	
	/* Layers */
	layer_0 [shape=plaintext, label="layer 0"];
	layer_0_b [style=invis, shape=point];
	layer_0_a [style=invis, shape=point];
	layer_0_b -> layer_0 [style=invis];
	layer_0 -> layer_0_a [style=invis];
	layer_1 [shape=plaintext, label="layer 1"];
	layer_1_b [style=invis, shape=point];
	layer_1_a [style=invis, shape=point];
	layer_1_b -> layer_1 [style=invis];
	layer_1 -> layer_1_a [style=invis];
	layer_0_a -> layer_1_b [style=invis];
	layer_2 [shape=plaintext, label="layer 2"];
	layer_2_b [style=invis, shape=point];
	layer_2_a [style=invis, shape=point];
	layer_2_b -> layer_2 [style=invis];
	layer_2 -> layer_2_a [style=invis];
	layer_1_a -> layer_2_b [style=invis];
	
	/* States */
	Sporo_end [label = "end"]
	Sporo_forces [label = "forces"]
	Sporo_read_states [label = "read_states"]
	Sporo_start [label = "start"]
	
	/* Functions */
	Sporo_write_state_start_read_states [label = "write_state", shape = rect]
	Sporo_read_states_read_states_forces [label = "read_states", shape = rect]
	Sporo_forces_forces_end [label = "forces", shape = rect]
	
	/* Message types */
	state_message [ label = "state" color="#00ff00" shape = parallelogram];
	state_message -> state_message_start_0 [ color="#00ff00" ];
	state_message_start_0 [ label = "start 0" color="#00ff00" shape = parallelogram];
	state_message_start_0 -> state_message_end_0 [ color="#00ff00" ];
	state_message_end_0 [ label = "end 1" color="#00ff00" shape = parallelogram];
	state_message_end_0 -> Sporo_read_states_read_states_forces [ color="#00ff00" label = "" ];
	
	/* Transitions */
	Sporo_start -> Sporo_write_state_start_read_states;
	Sporo_write_state_start_read_states -> Sporo_read_states;
	Sporo_read_states -> Sporo_read_states_read_states_forces;
	Sporo_read_states_read_states_forces -> Sporo_forces;
	Sporo_forces -> Sporo_forces_forces_end;
	Sporo_forces_forces_end -> Sporo_end;
	
	/* Communications */
	Sporo_write_state_start_read_states -> state_message [ color="#00ff00" ];
	{ rank=same; layer_0;  Sporo_write_state_start_read_states; }
	{ rank=same; layer_0_b; }
	{ rank=same; layer_0_a; state_message_start_0; }
	{ rank=same; layer_1;  Sporo_read_states_read_states_forces; }
	{ rank=same; layer_1_b; state_message_end_0; }
	{ rank=same; layer_1_a; }
	{ rank=same; layer_2;  Sporo_forces_forces_end; }
	{ rank=same; layer_2_b; }
	{ rank=same; layer_2_a; }
}